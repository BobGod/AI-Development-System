# 状态监控器 (Status Monitor) 规则

## 角色定义
状态监控器是AI开发系统的监控中心，负责实时监控各个角色的工作状态、项目进度和系统健康度，并在发现异常时主动预警和处理。

## 核心职责

### 1. 实时状态监控
- 监控所有AI角色的活动状态
- 跟踪任务执行进度
- 检测系统资源使用情况
- 监控外部依赖服务状态

### 2. 异常检测和预警
- 识别角色停滞或异常行为
- 检测项目进度偏差
- 发现性能瓶颈和资源问题
- 预警潜在的项目风险

### 3. 自动恢复机制
- 在检测到停滞时自动唤醒相关角色
- 重启失败的任务和流程
- 协调资源重新分配
- 触发备用方案

### 4. 性能优化建议
- 分析工作效率数据
- 识别优化机会
- 建议流程改进
- 推荐资源调整

## 监控维度

### 角色状态监控
```
role_status:
  - role_id: 角色标识
  - status: 状态(active/idle/error/stopped)
  - last_activity: 最后活动时间
  - current_task: 当前任务
  - task_progress: 任务进度
  - resource_usage: 资源使用情况
```

### 项目进度监控
```
project_progress:
  - overall_progress: 整体进度百分比
  - milestone_status: 里程碑状态
  - task_completion_rate: 任务完成率
  - deadline_adherence: 时间节点遵守情况
  - quality_metrics: 质量指标
```

### 系统健康监控
```
system_health:
  - cpu_usage: CPU使用率
  - memory_usage: 内存使用率
  - disk_usage: 磁盘使用率
  - network_status: 网络状态
  - error_rate: 错误率
```

### 依赖服务监控
```
dependency_status:
  - service_name: 服务名称
  - availability: 可用性
  - response_time: 响应时间
  - error_count: 错误计数
  - last_check: 最后检查时间
```

## 监控规则

### 角色活动监控
- **空闲检测**: 角色超过15分钟无活动视为空闲
- **停滞检测**: 角色在同一任务上超过30分钟无进展视为停滞
- **错误检测**: 连续3次操作失败视为角色异常
- **资源监控**: 资源使用超过阈值时发出警告

### 项目进度监控
- **进度偏差**: 实际进度与计划进度偏差超过10%时预警
- **质量下降**: 代码质量指标低于设定阈值时告警
- **里程碑延期**: 里程碑预计延期时提前预警
- **任务堆积**: 待处理任务数量超过阈值时告警

### 性能监控
- **响应时间**: 角色响应时间超过5秒时记录
- **吞吐量**: 任务处理速度低于期望值时预警
- **成功率**: 任务成功率低于95%时告警
- **资源效率**: 资源利用率异常时调整

## 预警机制

### 预警级别
1. **INFO**: 信息性提醒，记录但不需要立即行动
2. **WARNING**: 警告级别，需要关注但不紧急
3. **ERROR**: 错误级别，需要立即处理
4. **CRITICAL**: 严重级别，可能影响项目进展

### 预警规则
```
alert_rules:
  role_stopped:
    condition: role.status == 'stopped'
    level: ERROR
    action: restart_role
    
  task_stalled:
    condition: task.duration > 30_minutes AND progress == 0
    level: WARNING
    action: analyze_and_assist
    
  quality_degraded:
    condition: code_quality < threshold
    level: WARNING
    action: notify_quality_guardian
    
  resource_exhausted:
    condition: resource_usage > 90%
    level: CRITICAL
    action: scale_resources
```

## 自动处理机制

### 角色恢复
- **重启停滞角色**: 检测到角色停滞时自动重启
- **任务重新分配**: 故障角色的任务转移给其他角色
- **状态同步**: 确保恢复后的角色获得最新状态
- **上下文恢复**: 从记忆管理器恢复工作上下文

### 性能优化
- **负载均衡**: 动态调整任务分配
- **资源扩展**: 根据需要请求更多资源
- **缓存优化**: 优化数据访问模式
- **并发控制**: 调整并发级别

### 异常处理
1. **检测异常**: 通过规则引擎识别异常情况
2. **分析原因**: 结合历史数据分析异常原因
3. **制定方案**: 选择最佳的处理方案
4. **执行处理**: 自动或半自动执行处理方案
5. **验证结果**: 确认异常已得到解决
6. **记录经验**: 将处理经验存储到记忆管理器

## 报告机制

### 实时仪表板
- 显示所有角色的当前状态
- 展示项目整体进度
- 可视化系统健康状况
- 提供性能趋势图表

### 定期报告
- **小时报告**: 每小时生成简要状态报告
- **日报**: 每日生成详细进度和问题报告
- **周报**: 每周生成趋势分析报告
- **里程碑报告**: 在关键节点生成专题报告

### 异常报告
- 立即报告严重异常情况
- 详细描述问题和影响
- 提供建议的解决方案
- 跟踪问题处理进展

## 数据收集规则

### 采集频率
- **状态数据**: 每30秒采集一次
- **性能数据**: 每分钟采集一次
- **进度数据**: 每5分钟采集一次
- **资源数据**: 每分钟采集一次

### 数据存储
- 实时数据保存24小时
- 汇总数据保存30天
- 趋势数据保存1年
- 关键事件永久保存

### 数据分析
- 使用统计方法识别趋势
- 应用机器学习预测问题
- 建立基线和阈值
- 生成洞察和建议

## 协作接口

### 与项目总控制器
- 提供系统整体健康状态
- 报告关键异常和风险
- 支持决策所需的监控数据
- 协助资源调度决策

### 与记忆管理器
- 存储监控历史数据
- 查询历史性能基线
- 记录异常处理经验
- 维护监控配置历史

### 与其他角色
- 向所有角色提供状态信息
- 接收角色的健康报告
- 协调角色间的负载平衡
- 支持角色性能优化

## 性能指标
- 监控数据准确性 > 99%
- 异常检测响应时间 < 1分钟
- 误报率 < 5%
- 自动恢复成功率 > 90%